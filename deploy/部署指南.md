# ğŸš€ é˜¿é‡Œäº‘éƒ¨ç½²å®Œæ•´æ­¥éª¤ï¼ˆé›¶åŸºç¡€ï¼‰

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼Œæ‚¨å¯ä»¥å°†é¡¹ç›®æˆåŠŸéƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ã€‚

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### âœ… å‡†å¤‡å·¥ä½œ
- [ ] è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨
- [ ] é…ç½®å®‰å…¨ç»„ï¼ˆå¼€æ”¾22ã€80ã€443ã€3000ç«¯å£ï¼‰
- [ ] è·å– UploadThing å¯†é’¥
- [ ] ï¼ˆå¯é€‰ï¼‰è´­ä¹°åŸŸå

### âœ… æœåŠ¡å™¨é…ç½®
- [ ] è¿æ¥åˆ°æœåŠ¡å™¨
- [ ] è¿è¡Œç¯å¢ƒå®‰è£…è„šæœ¬
- [ ] éªŒè¯ç¯å¢ƒå®‰è£…

### âœ… ä»£ç éƒ¨ç½²
- [ ] ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] è¿è¡Œéƒ¨ç½²è„šæœ¬

### âœ… åŸŸåå’ŒSSLï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®åŸŸåè§£æ
- [ ] å®‰è£…SSLè¯ä¹¦
- [ ] é…ç½®Nginxåå‘ä»£ç†

## ğŸš€ è¯¦ç»†æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šè´­ä¹°å’Œé…ç½®æœåŠ¡å™¨ï¼ˆ10åˆ†é’Ÿï¼‰

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://ecs.console.aliyun.com
   - ç‚¹å‡»"åˆ›å»ºå®ä¾‹"

2. **é€‰æ‹©é…ç½®**
   ```
   åœ°åŸŸï¼šé€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„
   å®ä¾‹ï¼šecs.t5-lc1m2.small (1æ ¸2G) æˆ–æ›´é«˜
   é•œåƒï¼šUbuntu 20.04 64ä½
   å­˜å‚¨ï¼šç³»ç»Ÿç›˜ SSD 40GB
   ç½‘ç»œï¼šåˆ†é…å…¬ç½‘IP
   å®‰å…¨ç»„ï¼šå…è®¸22ã€80ã€443ã€3000ç«¯å£
   ```

3. **è®¾ç½®å¯†ç **
   - è®°ä½æ‚¨è®¾ç½®çš„rootå¯†ç 

### æ­¥éª¤2ï¼šè¿æ¥æœåŠ¡å™¨ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# Windows PowerShell æˆ– CMD
ssh root@ä½ çš„æœåŠ¡å™¨IP

# é¦–æ¬¡è¿æ¥é€‰æ‹© yes
# è¾“å…¥å¯†ç ç™»å½•
```

### æ­¥éª¤3ï¼šä¸€é”®å®‰è£…ç¯å¢ƒï¼ˆ15åˆ†é’Ÿï¼‰

```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
wget https://raw.githubusercontent.com/xi-ang/socialhop/master/deploy/setup.sh
chmod +x setup.sh
./setup.sh

# è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼š
# - Node.js 18
# - pnpm
# - PM2  
# - PostgreSQL
# - Nginx
```

### æ­¥éª¤4ï¼šä¸Šä¼ ä»£ç ï¼ˆ5åˆ†é’Ÿï¼‰

**æ–¹æ³•Aï¼šGitå…‹éš†ï¼ˆæ¨èï¼‰**
```bash
cd /var/www/social
git clone https://github.com/xi-ang/socialhop.git .
```

**æ–¹æ³•Bï¼šæœ¬åœ°ä¸Šä¼ **
```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
scp -r "E:\myy_work\social" root@ä½ çš„æœåŠ¡å™¨IP:/var/www/
```

### æ­¥éª¤5ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
cd /var/www/social
cp deploy/.env.production.template .env.production
vim .env.production

# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
# - åŸŸååœ°å€ï¼ˆå¦‚æœæœ‰ï¼‰
# - UploadThing å¯†é’¥
# - ç”Ÿæˆ NEXTAUTH_SECRET
```

### æ­¥éª¤6ï¼šéƒ¨ç½²åº”ç”¨ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# åœ¨æœåŠ¡å™¨çš„ /var/www/social ç›®å½•æ‰§è¡Œ
chmod +x deploy/deploy.sh
./deploy/deploy.sh

# è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
# - å®‰è£…ä¾èµ–
# - æ•°æ®åº“è¿ç§»
# - æ„å»ºé¡¹ç›®
# - å¯åŠ¨æœåŠ¡
```

### æ­¥éª¤7ï¼šéªŒè¯éƒ¨ç½²ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs social-app

# æµ‹è¯•è®¿é—®
curl http://localhost:3000
```

æµè§ˆå™¨è®¿é—®ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:3000`

### æ­¥éª¤8ï¼šé…ç½®åŸŸåå’ŒSSLï¼ˆå¯é€‰ï¼Œ20åˆ†é’Ÿï¼‰

å¦‚æœæ‚¨æœ‰åŸŸåï¼š

1. **é…ç½®åŸŸåè§£æ**
   - Aè®°å½•ï¼š@ â†’ æœåŠ¡å™¨IP
   - Aè®°å½•ï¼šwww â†’ æœåŠ¡å™¨IP

2. **å®‰è£…SSLè¯ä¹¦**
   ```bash
   sudo apt install certbot python3-certbot-nginx
   sudo systemctl stop nginx
   sudo certbot certonly --standalone -d ä½ çš„åŸŸå.com -d www.ä½ çš„åŸŸå.com
   ```

3. **é…ç½®Nginx**
   ```bash
   sudo cp deploy/nginx-config /etc/nginx/sites-available/social-app
   # ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ›¿æ¢åŸŸå
   sudo vim /etc/nginx/sites-available/social-app
   sudo ln -s /etc/nginx/sites-available/social-app /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl start nginx
   ```

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

### è®¿é—®åœ°å€
- **IPè®¿é—®**ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:3000
- **åŸŸåè®¿é—®**ï¼šhttps://ä½ çš„åŸŸå.com

### å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# é‡å¯åº”ç”¨
pm2 restart social-app

# æŸ¥çœ‹æ—¥å¿—
pm2 logs social-app

# æ›´æ–°ä»£ç 
cd /var/www/social
git pull
pnpm build
pm2 restart social-app

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
./deploy/monitor.sh
```

## ğŸš¨ å¦‚æœé‡åˆ°é—®é¢˜

### 1. åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pm2 logs social-app --lines 50

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.production
```

### 2. æ— æ³•è®¿é—®åº”ç”¨
```bash
# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :3000

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
pm2 status
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -U social_user -h localhost -d social_prod
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼š

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`pm2 logs social-app`
2. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ï¼š`./deploy/monitor.sh`
3. å‚è€ƒæ–‡æ¡£ç›®å½•ä¸‹çš„è¯¦ç»†æŒ‡å—
4. è”ç³»æŠ€æœ¯æ”¯æŒæˆ–æŸ¥çœ‹é¡¹ç›® Issues

**ğŸŠ æ­å–œï¼æ‚¨å·²æˆåŠŸå°†åº”ç”¨éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ï¼**
